
#Output from test_generator.py using NIST data and results
#It is advised that no changes are done in this file.
#Any desired modification should be generalised and added
#in test_generator.py
 
import numpy as np
import statsmodels.api as sm
from statsmodels.miscmodels.nonlinls import NonlinearLS
from numpy.testing import assert_almost_equal, assert_

class TestNonlinearLS(object):
    pass

class funcGauss2(NonlinearLS):

    def expr(self, params, exog=None):
        if exog is None:
            x = self.exog
        else:
            x = exog
        b1, b2, b3, b4, b5, b6, b7, b8 = params
        return b1*np.exp(-b2*x) + b3*np.exp(-(x-b4)**2/b5**2)+b6*np.exp(-(x-b7)**2/b8**2)

    def jacobian(self, params, exog=None):
        if exog is None:
            x = self.exog
        else:
            x = exog
        b1, b2, b3, b4, b5, b6, b7, b8 = params
        return np.column_stack([np.exp(-b2*x),-b1*x*np.exp(-b2*x),np.exp(-(x-b4)**2/b5**2),(2*(x-b4)/b5**2)*b3*np.exp(-(x-b4)**2/b5**2),(2*(x-b4)**2/b5**3)*b3*np.exp(-(x-b4)**2/b5**2),np.exp(-(x-b7)**2/b8**2),(2*(x-b7)/b8**2)*b6*np.exp(-(x-b7)**2/b8**2),(2*(x-b7)**2/b8**3)*b6*np.exp(-(x-b7)**2/b8**2)])

class TestGauss2(TestNonlinearLS):

    def setup(self):
        x = np.array([1.0,
                   2.0,
                   3.0,
                   4.0,
                   5.0,
                   6.0,
                   7.0,
                   8.0,
                   9.0,
                   10.0,
                   11.0,
                   12.0,
                   13.0,
                   14.0,
                   15.0,
                   16.0,
                   17.0,
                   18.0,
                   19.0,
                   20.0,
                   21.0,
                   22.0,
                   23.0,
                   24.0,
                   25.0,
                   26.0,
                   27.0,
                   28.0,
                   29.0,
                   30.0,
                   31.0,
                   32.0,
                   33.0,
                   34.0,
                   35.0,
                   36.0,
                   37.0,
                   38.0,
                   39.0,
                   40.0,
                   41.0,
                   42.0,
                   43.0,
                   44.0,
                   45.0,
                   46.0,
                   47.0,
                   48.0,
                   49.0,
                   50.0,
                   51.0,
                   52.0,
                   53.0,
                   54.0,
                   55.0,
                   56.0,
                   57.0,
                   58.0,
                   59.0,
                   60.0,
                   61.0,
                   62.0,
                   63.0,
                   64.0,
                   65.0,
                   66.0,
                   67.0,
                   68.0,
                   69.0,
                   70.0,
                   71.0,
                   72.0,
                   73.0,
                   74.0,
                   75.0,
                   76.0,
                   77.0,
                   78.0,
                   79.0,
                   80.0,
                   81.0,
                   82.0,
                   83.0,
                   84.0,
                   85.0,
                   86.0,
                   87.0,
                   88.0,
                   89.0,
                   90.0,
                   91.0,
                   92.0,
                   93.0,
                   94.0,
                   95.0,
                   96.0,
                   97.0,
                   98.0,
                   99.0,
                   100.0,
                   101.0,
                   102.0,
                   103.0,
                   104.0,
                   105.0,
                   106.0,
                   107.0,
                   108.0,
                   109.0,
                   110.0,
                   111.0,
                   112.0,
                   113.0,
                   114.0,
                   115.0,
                   116.0,
                   117.0,
                   118.0,
                   119.0,
                   120.0,
                   121.0,
                   122.0,
                   123.0,
                   124.0,
                   125.0,
                   126.0,
                   127.0,
                   128.0,
                   129.0,
                   130.0,
                   131.0,
                   132.0,
                   133.0,
                   134.0,
                   135.0,
                   136.0,
                   137.0,
                   138.0,
                   139.0,
                   140.0,
                   141.0,
                   142.0,
                   143.0,
                   144.0,
                   145.0,
                   146.0,
                   147.0,
                   148.0,
                   149.0,
                   150.0,
                   151.0,
                   152.0,
                   153.0,
                   154.0,
                   155.0,
                   156.0,
                   157.0,
                   158.0,
                   159.0,
                   160.0,
                   161.0,
                   162.0,
                   163.0,
                   164.0,
                   165.0,
                   166.0,
                   167.0,
                   168.0,
                   169.0,
                   170.0,
                   171.0,
                   172.0,
                   173.0,
                   174.0,
                   175.0,
                   176.0,
                   177.0,
                   178.0,
                   179.0,
                   180.0,
                   181.0,
                   182.0,
                   183.0,
                   184.0,
                   185.0,
                   186.0,
                   187.0,
                   188.0,
                   189.0,
                   190.0,
                   191.0,
                   192.0,
                   193.0,
                   194.0,
                   195.0,
                   196.0,
                   197.0,
                   198.0,
                   199.0,
                   200.0,
                   201.0,
                   202.0,
                   203.0,
                   204.0,
                   205.0,
                   206.0,
                   207.0,
                   208.0,
                   209.0,
                   210.0,
                   211.0,
                   212.0,
                   213.0,
                   214.0,
                   215.0,
                   216.0,
                   217.0,
                   218.0,
                   219.0,
                   220.0,
                   221.0,
                   222.0,
                   223.0,
                   224.0,
                   225.0,
                   226.0,
                   227.0,
                   228.0,
                   229.0,
                   230.0,
                   231.0,
                   232.0,
                   233.0,
                   234.0,
                   235.0,
                   236.0,
                   237.0,
                   238.0,
                   239.0,
                   240.0,
                   241.0,
                   242.0,
                   243.0,
                   244.0,
                   245.0,
                   246.0,
                   247.0,
                   248.0,
                   249.0,
                   250.0])
        y = np.array([97.587760000000003,
                   97.763440000000003,
                   96.567049999999995,
                   92.52037,
                   91.150970000000001,
                   95.217280000000002,
                   90.213549999999998,
                   89.292349999999999,
                   91.514790000000005,
                   89.609660000000005,
                   86.561869999999999,
                   85.553160000000005,
                   87.130539999999996,
                   85.679400000000001,
                   80.048509999999993,
                   82.189250000000001,
                   87.240809999999996,
                   80.794070000000005,
                   81.285700000000006,
                   81.569400000000002,
                   79.227149999999995,
                   79.432749999999999,
                   77.901949999999999,
                   76.754679999999993,
                   77.173770000000005,
                   74.273480000000006,
                   73.119,
                   73.848259999999996,
                   72.478700000000003,
                   71.922920000000005,
                   66.921760000000006,
                   67.93835,
                   69.562070000000006,
                   69.070660000000004,
                   66.539829999999995,
                   63.878830000000001,
                   69.715369999999993,
                   63.605879999999999,
                   63.371540000000003,
                   60.018349999999998,
                   62.674810000000001,
                   65.806659999999994,
                   59.143039999999999,
                   56.629510000000003,
                   61.217849999999999,
                   54.387900000000002,
                   62.934429999999999,
                   56.651440000000001,
                   57.133620000000001,
                   58.296889999999998,
                   58.917439999999999,
                   58.501719999999999,
                   55.228850000000001,
                   58.303750000000001,
                   57.432369999999999,
                   51.694070000000004,
                   49.931319999999999,
                   53.707599999999999,
                   55.397120000000001,
                   52.897089999999999,
                   52.316490000000002,
                   53.987200000000001,
                   53.541580000000003,
                   56.45046,
                   51.322760000000002,
                   53.116759999999999,
                   53.28631,
                   49.805549999999997,
                   54.695639999999997,
                   56.416269999999997,
                   54.593620000000001,
                   54.385199999999998,
                   60.15354,
                   59.787730000000003,
                   60.499949999999998,
                   65.438850000000002,
                   60.700009999999999,
                   63.718649999999997,
                   67.771389999999997,
                   64.709339999999997,
                   70.781930000000003,
                   70.386510000000001,
                   77.223590000000002,
                   79.526650000000004,
                   80.130769999999998,
                   85.678229999999999,
                   85.206469999999996,
                   90.245480000000001,
                   93.619529999999997,
                   95.865089999999995,
                   93.469920000000002,
                   105.8137,
                   107.82689999999999,
                   114.0607,
                   115.50190000000001,
                   118.511,
                   119.6177,
                   122.194,
                   126.9903,
                   125.70050000000001,
                   123.74469999999999,
                   130.65430000000001,
                   129.71680000000001,
                   131.82400000000001,
                   131.8759,
                   131.99940000000001,
                   132.12209999999999,
                   133.44139999999999,
                   133.8252,
                   133.6695,
                   128.2851,
                   126.51819999999999,
                   124.755,
                   118.4016,
                   122.0334,
                   115.2059,
                   118.7856,
                   110.73869999999999,
                   110.2003,
                   105.1729,
                   103.4472,
                   94.5428,
                   94.405259999999998,
                   94.579639999999998,
                   88.766050000000007,
                   87.287469999999999,
                   92.504429999999999,
                   86.279970000000006,
                   82.443070000000006,
                   80.473669999999998,
                   78.366079999999997,
                   78.743070000000003,
                   76.127859999999998,
                   79.131079999999997,
                   76.760620000000003,
                   77.607690000000005,
                   77.766329999999996,
                   81.282200000000003,
                   79.743070000000003,
                   81.979640000000003,
                   80.029520000000005,
                   85.95232,
                   85.968379999999996,
                   79.947890000000001,
                   87.170230000000004,
                   90.509919999999994,
                   93.233729999999994,
                   89.148030000000006,
                   93.114919999999998,
                   90.343369999999993,
                   93.694209999999998,
                   95.742559999999997,
                   91.851050000000001,
                   96.74503,
                   87.609960000000001,
                   90.470119999999994,
                   88.116900000000001,
                   85.706729999999993,
                   85.01361,
                   78.5304,
                   81.341480000000004,
                   75.192949999999996,
                   72.661150000000006,
                   69.855040000000002,
                   66.294759999999997,
                   63.58502,
                   58.338470000000001,
                   57.507660000000001,
                   52.80498,
                   50.793190000000003,
                   47.0349,
                   46.4709,
                   43.090159999999997,
                   34.115310000000001,
                   39.282350000000001,
                   32.683860000000003,
                   30.440560000000001,
                   31.989319999999999,
                   23.633299999999998,
                   23.696429999999999,
                   20.26812,
                   19.070740000000001,
                   17.59544,
                   16.08785,
                   18.94267,
                   18.61354,
                   17.257999999999999,
                   16.62285,
                   13.48367,
                   15.376469999999999,
                   13.47208,
                   15.961880000000001,
                   12.325469999999999,
                   16.338799999999999,
                   10.438330000000001,
                   9.6287149999999997,
                   13.122680000000001,
                   8.7724170000000008,
                   11.761430000000001,
                   12.5502,
                   11.33108,
                   11.204929999999999,
                   7.816916,
                   6.800675,
                   14.26581,
                   10.662850000000001,
                   8.9115739999999999,
                   11.56733,
                   11.58207,
                   11.59071,
                   9.7301339999999996,
                   11.44237,
                   11.22912,
                   10.172129999999999,
                   12.50905,
                   6.2014930000000001,
                   9.0196050000000003,
                   10.80607,
                   13.09625,
                   3.9142709999999998,
                   9.5678859999999997,
                   8.0384480000000007,
                   10.23104,
                   9.3674099999999996,
                   7.6959710000000001,
                   6.1185749999999999,
                   8.7932070000000007,
                   7.7966920000000002,
                   12.45065,
                   10.616009999999999,
                   6.0010029999999999,
                   6.7650980000000001,
                   8.7646529999999991,
                   4.5864180000000001,
                   8.3907830000000008,
                   7.2092020000000003,
                   10.012090000000001,
                   7.3274609999999996,
                   6.5251359999999998,
                   2.8400650000000001,
                   10.32371,
                   4.7900349999999996,
                   8.3764310000000002,
                   6.2639800000000001,
                   2.705892,
                   8.3621090000000002,
                   8.9835069999999995,
                   3.3624689999999999,
                   1.1826779999999999,
                   4.8753120000000001])
        mod1 = funcGauss2(y, x)
        self.res_start1 = mod1.fit(start_value=[96.0, 0.0089999999999999993, 103.0, 106.0, 18.0, 72.0, 151.0, 18.0])
        mod2 = funcGauss2(y, x)
        self.res_start2 = mod2.fit(start_value=[98.0, 0.010500000000000001, 103.0, 105.0, 20.0, 73.0, 150.0, 20.0])

    def test_basic(self):
        res1 = self.res_start1
        res2 = self.res_start2
        assert_almost_equal(res1.params,[99.018328405999995, 0.010994945399, 101.88022528, 107.03095519, 23.578584029000002, 72.045589471, 153.27010193999999, 19.525972635999999],decimal=3)
        assert_almost_equal(res2.params,[99.018328405999995, 0.010994945399, 101.88022528, 107.03095519, 23.578584029000002, 72.045589471, 153.27010193999999, 19.525972635999999],decimal=3)
