
#Output from test_generator.py using NIST data and results
#It is advised that no changes are done in this file.
#Any desired modification should be generalised and added
#in test_generator.py
 
import numpy as np
import statsmodels.api as sm
from statsmodels.miscmodels.nonlinls import NonlinearLS
from numpy.testing import assert_almost_equal, assert_

class TestNonlinearLS(object):
    pass

class funcChwirut1(NonlinearLS):

    def expr(self, params, exog=None):
        if exog is None:
            x = self.exog
        else:
            x = exog
        b1, b2, b3 = params
        return np.exp(-b1*x)/(b2+b3*x)

    def jacobian(self, params, exog=None):
        if exog is None:
            x = self.exog
        else:
            x = exog
        b1, b2, b3 = params
        return np.column_stack([(-x)*np.exp(-b1*x)/(b2+b3*x),(-1)*np.exp(-b1*x)/(b2+b3*x)**2,(-x)*np.exp(-b1*x)/(b2+b3*x)**2])

class TestChwirut1(TestNonlinearLS):

    def setup(self):
        x = np.array([0.5,
                   0.625,
                   0.75,
                   0.875,
                   1.0,
                   1.25,
                   1.75,
                   2.25,
                   1.75,
                   2.25,
                   2.75,
                   3.25,
                   3.75,
                   4.25,
                   4.75,
                   5.25,
                   5.75,
                   0.5,
                   0.625,
                   0.75,
                   0.875,
                   1.0,
                   1.25,
                   1.75,
                   2.25,
                   1.75,
                   2.25,
                   2.75,
                   3.25,
                   3.75,
                   4.25,
                   4.75,
                   5.25,
                   5.75,
                   0.5,
                   0.625,
                   0.75,
                   0.875,
                   1.0,
                   1.25,
                   1.75,
                   2.25,
                   1.75,
                   2.25,
                   2.75,
                   3.25,
                   3.75,
                   4.25,
                   4.75,
                   5.25,
                   5.75,
                   0.5,
                   0.625,
                   0.75,
                   0.875,
                   1.0,
                   1.25,
                   1.75,
                   2.25,
                   1.75,
                   2.25,
                   2.75,
                   3.25,
                   3.75,
                   4.25,
                   4.75,
                   5.25,
                   5.75,
                   0.5,
                   0.75,
                   1.5,
                   3.0,
                   3.0,
                   3.0,
                   6.0,
                   0.5,
                   0.75,
                   1.5,
                   3.0,
                   3.0,
                   3.0,
                   6.0,
                   0.5,
                   0.75,
                   1.5,
                   3.0,
                   3.0,
                   3.0,
                   6.0,
                   0.5,
                   0.75,
                   1.5,
                   3.0,
                   6.0,
                   3.0,
                   3.0,
                   6.0,
                   0.5,
                   0.75,
                   1.0,
                   1.5,
                   2.0,
                   2.0,
                   2.5,
                   3.0,
                   4.0,
                   5.0,
                   6.0,
                   0.5,
                   0.75,
                   1.0,
                   1.5,
                   2.0,
                   2.0,
                   2.5,
                   3.0,
                   4.0,
                   5.0,
                   6.0,
                   0.5,
                   0.75,
                   1.0,
                   1.5,
                   2.0,
                   2.0,
                   2.5,
                   3.0,
                   4.0,
                   5.0,
                   6.0,
                   0.5,
                   0.625,
                   0.75,
                   0.875,
                   1.0,
                   1.25,
                   2.25,
                   2.25,
                   2.75,
                   3.25,
                   3.75,
                   4.25,
                   4.75,
                   5.25,
                   5.75,
                   3.0,
                   3.0,
                   3.0,
                   3.0,
                   3.0,
                   3.0,
                   0.5,
                   0.75,
                   1.0,
                   1.5,
                   2.0,
                   2.5,
                   2.0,
                   2.5,
                   3.0,
                   4.0,
                   5.0,
                   6.0,
                   0.5,
                   0.75,
                   1.0,
                   1.5,
                   2.0,
                   2.5,
                   2.0,
                   2.5,
                   3.0,
                   4.0,
                   5.0,
                   6.0,
                   0.5,
                   0.75,
                   1.0,
                   1.5,
                   2.0,
                   2.5,
                   2.0,
                   2.5,
                   3.0,
                   4.0,
                   5.0,
                   6.0,
                   3.0,
                   0.5,
                   0.75,
                   1.5,
                   3.0,
                   6.0,
                   3.0,
                   6.0,
                   3.0,
                   3.0,
                   3.0,
                   1.75,
                   1.75,
                   0.5,
                   0.75,
                   1.75,
                   1.75,
                   2.75,
                   3.75,
                   1.75,
                   1.75,
                   0.5,
                   0.75,
                   2.75,
                   3.75,
                   1.75,
                   1.75])
        y = np.array([92.900000000000006,
                   78.700000000000003,
                   64.200000000000003,
                   64.900000000000006,
                   57.100000000000001,
                   43.299999999999997,
                   31.100000000000001,
                   23.600000000000001,
                   31.050000000000001,
                   23.774999999999999,
                   17.737500000000001,
                   13.800000000000001,
                   11.5875,
                   9.4124999999999996,
                   7.7249999999999996,
                   7.3499999999999996,
                   8.0250000000000004,
                   90.599999999999994,
                   76.900000000000006,
                   71.599999999999994,
                   63.600000000000001,
                   54.0,
                   39.200000000000003,
                   29.300000000000001,
                   21.399999999999999,
                   29.175000000000001,
                   22.125,
                   17.512499999999999,
                   14.25,
                   9.4499999999999993,
                   9.1500000000000004,
                   7.9124999999999996,
                   8.4749999999999996,
                   6.1124999999999998,
                   80.0,
                   79.0,
                   63.799999999999997,
                   57.200000000000003,
                   53.200000000000003,
                   42.5,
                   26.800000000000001,
                   20.399999999999999,
                   26.850000000000001,
                   21.0,
                   16.462499999999999,
                   12.525,
                   10.5375,
                   8.5875000000000004,
                   7.125,
                   6.1124999999999998,
                   5.9625000000000004,
                   74.099999999999994,
                   67.299999999999997,
                   60.799999999999997,
                   55.5,
                   50.299999999999997,
                   41.0,
                   29.399999999999999,
                   20.399999999999999,
                   29.362500000000001,
                   21.149999999999999,
                   16.762499999999999,
                   13.199999999999999,
                   10.875,
                   8.1750000000000007,
                   7.3499999999999996,
                   5.9625000000000004,
                   5.625,
                   81.5,
                   62.399999999999999,
                   32.5,
                   12.41,
                   13.119999999999999,
                   15.56,
                   5.6299999999999999,
                   78.0,
                   59.899999999999999,
                   33.200000000000003,
                   13.84,
                   12.75,
                   14.619999999999999,
                   3.9399999999999999,
                   76.799999999999997,
                   61.0,
                   32.899999999999999,
                   13.869999999999999,
                   11.81,
                   13.31,
                   5.4400000000000004,
                   78.0,
                   63.5,
                   33.799999999999997,
                   12.56,
                   5.6299999999999999,
                   12.75,
                   13.119999999999999,
                   5.4400000000000004,
                   76.799999999999997,
                   60.0,
                   47.799999999999997,
                   32.0,
                   22.199999999999999,
                   22.57,
                   18.82,
                   13.949999999999999,
                   11.25,
                   9.0,
                   6.6699999999999999,
                   75.799999999999997,
                   62.0,
                   48.799999999999997,
                   35.200000000000003,
                   20.0,
                   20.32,
                   19.309999999999999,
                   12.75,
                   10.42,
                   7.3099999999999996,
                   7.4199999999999999,
                   70.5,
                   59.5,
                   48.5,
                   35.799999999999997,
                   21.0,
                   21.670000000000002,
                   21.0,
                   15.640000000000001,
                   8.1699999999999999,
                   8.5500000000000007,
                   10.119999999999999,
                   78.0,
                   66.0,
                   62.0,
                   58.0,
                   47.700000000000003,
                   37.799999999999997,
                   20.199999999999999,
                   21.07,
                   13.869999999999999,
                   9.6699999999999999,
                   7.7599999999999998,
                   5.4400000000000004,
                   4.8700000000000001,
                   4.0099999999999998,
                   3.75,
                   24.190000000000001,
                   25.760000000000002,
                   18.07,
                   11.81,
                   12.07,
                   16.120000000000001,
                   70.799999999999997,
                   54.700000000000003,
                   48.0,
                   39.799999999999997,
                   29.800000000000001,
                   23.699999999999999,
                   29.620000000000001,
                   23.809999999999999,
                   17.699999999999999,
                   11.550000000000001,
                   12.07,
                   8.7400000000000002,
                   80.700000000000003,
                   61.299999999999997,
                   47.5,
                   29.0,
                   24.0,
                   17.699999999999999,
                   24.559999999999999,
                   18.670000000000002,
                   16.239999999999998,
                   8.7400000000000002,
                   7.8700000000000001,
                   8.5099999999999998,
                   66.700000000000003,
                   59.200000000000003,
                   40.799999999999997,
                   30.699999999999999,
                   25.699999999999999,
                   16.300000000000001,
                   25.989999999999998,
                   16.949999999999999,
                   13.35,
                   8.6199999999999992,
                   7.2000000000000002,
                   6.6399999999999997,
                   13.69,
                   81.0,
                   64.5,
                   35.5,
                   13.31,
                   4.8700000000000001,
                   12.94,
                   5.0599999999999996,
                   15.19,
                   14.619999999999999,
                   15.640000000000001,
                   25.5,
                   25.949999999999999,
                   81.700000000000003,
                   61.600000000000001,
                   29.800000000000001,
                   29.809999999999999,
                   17.170000000000002,
                   10.390000000000001,
                   28.399999999999999,
                   28.690000000000001,
                   81.299999999999997,
                   60.899999999999999,
                   16.649999999999999,
                   10.050000000000001,
                   28.899999999999999,
                   28.949999999999999])
        mod1 = funcChwirut1(y, x)
        self.res_start1 = mod1.fit(start_value=[0.10000000000000001, 0.01, 0.02])
        mod2 = funcChwirut1(y, x)
        self.res_start2 = mod2.fit(start_value=[0.14999999999999999, 0.0080000000000000002, 0.01])

    def test_basic(self):
        res1 = self.res_start1
        res2 = self.res_start2
        assert_almost_equal(res1.params,[0.19027818369999999, 0.0061314004476999999, 0.010530908399],decimal=3)
        assert_almost_equal(res2.params,[0.19027818369999999, 0.0061314004476999999, 0.010530908399],decimal=3)
